<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VPlus CMS</title>
<link rel="stylesheet" href="assets/css/bootstrap.css">
<link rel="stylesheet" href="assets/css/bootstrap-responsive.css">
<link rel="stylesheet" href="../ng-table/ng-table.css">

<style type="text/css">
</style>
</head>

<body data-ng-app="VPlus">
	<div class="container-fluid">
		<div class="row-fluid">
			<div class="span2">
				<ul>
					<li>
						<a href="#../home">Home</a>
					</li>
					<li>
						<a href="#/content">Grid</a>
					</li>
					<li>
						<a href="#/content/add">Add</a>
					</li>
				</ul>
			</div>
			<div class="span10">
				<div data-ng-view></div>
			</div>
		</div>
	</div>
	<script src="assets/jquery-1.10.2.min.js"></script>
	<script src="assets/js/bootstrap.js"></script>

	<script type="text/javascript" src="../vplus/vendor/angular/angular.js"></script>
	<script type="text/javascript" src="../vplus/vendor/angular/angular-resource.js"></script>
	<script type="text/javascript" src="../vplus/vendor/angular/angular-sanitize.js"></script>
	<script type="text/javascript" src="../vplus/vendor/angular-ui/ui-utils.min.js"></script>
	<script type="text/javascript" src="../vplus/vendor/angular-ui/bootstrap/ui-bootstrap-tpls-0.5.0.js"></script>
	<script type="text/javascript" src="../vplus/vendor/angular-ui/ng-grid/ng-grid-2.0.7.min.js"></script>
	<script type="text/javascript" src="../ng-table/ng-table.js"></script>


	<script type="text/javascript" src="../vplus/src/VPlusNamespace.js"></script>
	<script type="text/javascript" src="../vplus/src/VPlusConf.js"></script>
	<script type="text/javascript" src="../vplus/src/VPlusServices.js"></script>
	<script type="text/javascript" src="../vplus/src/VPlusCtrls.js"></script>
	<script type="text/javascript">
		angular.module('VPlus.Config').constant('URL', '/vplus-cms-admin/content').constant('menus', '')

		.config([ '$routeProvider', function($routeProvider) {
			$routeProvider
			.when('/', { templateUrl: '../home.html' })
			.when('/content', {
				templateUrl : 'content-grid.html',
				controller : 'ContentGridCtrl'
			})
			.when('/content/add', {
				templateUrl : 'content-form.html',
				controller : 'ContentFormCtrl'
			})
			.when('/content/:id', {
				templateUrl : 'content-form.html',
				controller : 'ContentFormCtrl'
			})
			.otherwise({
				redirectTo : '/'
			});
		} ]);

		angular.module('VPlus')
			.controller('ContentGridCtrl', ['$scope', '$filter', 'Rest', 'ngTableParams',
				function($scope, $filter, Rest, Table) {

					$scope.tableParams = {};
					
					Rest.query(function(data) {
						$scope.list = data;
						$scope.tableParams = new Table({
							page : 1,
							total : data.length,
							count : 10
						})
					});
					
					$scope.$watch('tableParams', function(params) {
						var orderedData = params.filter ? $filter('filter')($scope.list, params.filter) : $scope.list;
						orderedData = params.sorting ? $filter('orderBy')(orderedData, params.orderBy()) : orderedData;
						
						if(typeof orderedData != 'undefined') {
							params.total = orderedData.length;
	
							$scope.items = orderedData.slice(
									(params.page - 1) * params.count,
									params.page * params.count);
						}
					}, true);
					

				} ])
				.controller('ContentFormCtrl', ['$scope', 'Rest', '$routeParams',
				function($scope, Rest, $routeParams) {
					
					if($routeParams.id == null) {
						$scope.model = new Rest();
					}
					else {
						Rest.get({id: $routeParams.id}, function(result) {
							$scope.model = result;
						});
					}
					
					$scope.persist = function() {
				    	if($scope.model.id == null) {
				    		$scope.model.$save();
				    	}
				    	else {
				     		$scope.model.$update({ id: $scope.model.id });
				    	}
				    }

				} ])
				;
		
	</script>
</body>
</html>